<!DOCTYPE html>
<title>CSS Basic User Interface Test: transparent accent color</title>
<link rel="author" title="Florian Rivoal" href="https://florian.rivoal.net">
<link rel="help" href="https://drafts.csswg.org/css-ui-4/#widget-accent">
<style>

  div {
      border: solid orange;
      padding: 1ch;
      margin: 1ch;
      float: left;
  }
  
  input { color-scheme: dark;}
  #extract-canvas{ accent-color: canvas; display:none;}
  #t3 { background: orange;}
  
</style>
  
<p>Test passes if in each box below, you see a pair of identically colored check-boxes.

<input id='extract-canvas' type=checkbox>
<div id=t1 class="container">
  <input class=test type=checkbox checked>
  <input class=ref type=checkbox checked>
</div>

<div id=t2 class="container">
  <input class=test type=checkbox checked>
  <input class=ref type=checkbox checked>
</div>

<div id=t3 class="container">
  <input class=test type=checkbox checked>
  <input class=ref type=checkbox checked>
</div>

<script>
  
  var testColors = [[255,0,0,0], [0,0,255,0.5], [0,0,255,0.5]]

  function getColorComponents(color){
    var components = []
    color.substring(color.indexOf("(") + 1).replace(/\s/g,"").split(",").forEach((s) => {
      components.push(parseFloat(s));
    });
    return components;
  }

  function constructCSSColor(components){
    if (components.length == 4)
      return "rgba(" + components[0] + ", " + components[1] + ", " + components[2] + ", " + components[3] + ")";
    return "rgb(" + components[0] + ", " + components[1] + ", " + components[2] + ")";
  }

  function computeExpectedColor(canvasColor,colorWithAlpha){
    var expected = []
    for (var i = 0; i < 3; i++)
      expected.push(canvasColor[i] - canvasColor[i] * colorWithAlpha[3] + colorWithAlpha[i] * colorWithAlpha[3])
    return expected;
  }

  var testContainers = document.getElementsByClassName("container");
  var canvasColorComponents = getColorComponents(window.getComputedStyle(document.getElementById('extract-canvas')).accentColor);
  for (var i = 0; i < testContainers.length; i++){
    testContainers[i].getElementsByClassName("test")[0].style.accentColor = constructCSSColor(computeExpectedColor(canvasColorComponents,testColors[i]));
    testContainers[i].getElementsByClassName("ref")[0].style.accentColor = constructCSSColor(computeExpectedColor(canvasColorComponents,testColors[i]));
  }

</script>